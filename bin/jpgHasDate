#! /bin/bash 
#title           :jpgHasDate.sh
#description     :Determine if an JPEG file has a date
#author		 :gmj@pobox.com
#date            :Sat Dec 19 15:35:06 2015
#version         :0.1
#usage		 :jpgHasDate.sh [optinos] FILE [FILE...]
#notes           :
#bash_version    :
#==============================================================================

set -u   # exit on undefined
set -e   # exit on error
# set -x # echo during execution

# Option parsing courtesy of 
# http://stackoverflow.com/questions/402377/using-getopts-in-bash-shell-script-to-get-long-and-short-command-line-options


# NOTE: This requires GNU getopt.  On Mac OS X and FreeBSD, you have to install this
# separately; see below.
TEMP=`getopt -o wmptvd --long withdates,missingdates,path,dates,verbose,debug \
             -n 'jpghasDate' -- "$@"`

if [ $? != 0 ] ; then echo "Terminating..." >&2 ; exit 1 ; fi

# Note the quotes around `$TEMP': they are essential!
eval set -- "$TEMP"

# Selection Parameters
SELECT_WITH_DATES=ture		# print files that have dates
SELECT_MISSING_DATES=ture	# print files with no date
# Output Parameters
VERBOSE=false			# verbose output
DEBUG=false			# debugging output
PRINT_PATH=false  		# print path
PRINT_DATES=false		# print date
PRINT_ALL=true			# print all (default)

DEBUGFILE=
JAVA_MISC_OPT=
while true; do
  case "$1" in
    -w | --withdates ) SELECT_WITH_DATES=true; shift ;;
    -m | --missingdates ) SELECT_MISSING_DATES=true; shift ;;
    -p | --path ) PRINT_PATH=true; shift ;;
    -t | --dates ) PRINT_DATES=true; shift ;;
    -v | --verbose ) VERBOSE=true; shift ;;
    -d | --debug ) DEBUG=true; shift ;;    
    -- ) shift; break ;;
    * ) break ;;
  esac
done


# Defualt to printing all
if ! ( $PRINT_PATH || $PRINT_DATES ); then 
    PRINT_PATH=true
    PRINT_DATES=true
fi    

for file in $*; do
    if $DEBUG; then echo file $file >&2; fi
    text=$(exiftool $file | grep Orig || echo "NONE")
    text=$(echo $text | sed -e 's/Date\/Time Original\s*\:\s*//')
    output=""
    if $PRINT_PATH; then output="$file"; fi
    if $PRINT_DATES; then output="$output : $text"; fi
    echo $output
done
